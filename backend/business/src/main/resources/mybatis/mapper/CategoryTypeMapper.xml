<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.perfect.team.business.mapper.CategoryTypeMapper">

  <resultMap id="categoryTypeResultMap" type="CategoryType">
    <id column="id" property="id"/>
    <result column="name" property="name"/>
    <result column="balance_type" property="balanceType"/>
    <collection column="id" columnPrefix="category_" foreignColumn="category_type_id"
      property="categories"
      resultMap="com.perfect.team.business.mapper.CategoryMapper.categoryResultMap"/>
  </resultMap>

  <sql id="categoryTypeColumns">
    ${categoryType}.id as "${prefix}id",
    ${categoryType}.name as "${prefix}name",
    ${categoryType}.balance_type as "${prefix}balance_type"
  </sql>

  <insert id="insert" keyProperty="id" useGeneratedKeys="true">
    INSERT INTO category_type (name, balance_type)
    VALUES (#{name}, #{balanceType})
  </insert>

  <select id="select" resultMap="categoryTypeResultMap">
    SELECT
    <include refid="categoryTypeColumns">
      <property name="categoryType" value="ct"/>
      <property name="prefix" value=""/>
    </include>
    FROM category_type ct
    WHERE ct.id = #{id}
  </select>

  <update id="update" keyProperty="id" useGeneratedKeys="true">
    UPDATE category_type
    <set>
      <if test="name != null">name = #{name},</if>
      <if test="balanceType != null">balance_type = #{balanceType}</if>
    </set>
    WHERE id = #{id}
  </update>

  <delete id="delete">
    DELETE FROM category_type
    WHERE id = #{id}
  </delete>

  <select id="selectAll" resultMap="categoryTypeResultMap">
    SELECT
    <include refid="categoryTypeColumns">
      <property name="categoryType" value="ct"/>
      <property name="prefix" value=""/>
    </include>
    FROM category_type ct
  </select>
</mapper>
